<project default="run" name="ERNIE" basedir=".">
  <property name="sources" value="src/"/>
  <property name="classes" value="bin/"/>
  <property name="docs" value="javadoc/"/>
  <target name="init">
    <mkdir dir="${classes}"/>
  </target>
  <target name="compile" depends="init"> 
    <javac srcdir="${sources}"
           destdir="${classes}"
           excludes="org/torproject/ernie/web/"
           debug="true" debuglevel="lines,source"
           classpath="lib/commons-codec-1.4.jar;lib/commons-compress-1.0.jar"/>
  </target>
  <target name="run" depends="compile">
    <java classpath="${classes};lib/commons-codec-1.4.jar:lib/commons-compress-1.0.jar;postgresql-8.4-701.jdbc4.jar"
          fork="true"
          maxmemory="1024m"
          classname="Main"/>
  </target>
  <target name="docs">
    <mkdir dir="${docs}"/>
    <javadoc destdir="${docs}"
             classpath="lib/commons-codec-1.4.jar;lib/commons-compress-1.0.jar">
      <fileset dir="${sources}/" includes="**/*.java" />
    </javadoc>
  </target>

  <!-- This target is a hack -->
  <target name="tomcat">
    <mkdir dir="dist"/>
    <mkdir dir="dist/WEB-INF"/>
    <mkdir dir="dist/WEB-INF/classes"/>
    <javac srcdir="src/org/torproject/ernie"
          destdir="dist/WEB-INF/classes"
          debug="true" debuglevel="lines,source"
          classpath="lib/commons-codec-1.4.jar;lib/commons-compress-1.0.jar;lib/servlet-api.jar"/>
    <copy todir="dist/WEB-INF" file="etc/web.xml"/>
    <copy todir="dist/WEB-INF" file="R/consensus.R"/>
<!-- We could copy all R files, but we don't need them.
    <copy todir="dist/WEB-INF">
      <fileset dir="R"/>
    </copy>-->
    <copy todir="dist">
      <fileset dir="website">
        <include name="*.html"/>
        <exclude name="consensus-health.html"/>
        <exclude name="consensus-health-1.html"/>
        <exclude name="consensus-health-2.html"/>
        <exclude name="log.html"/>
      </fileset>
    </copy>
    <copy todir="dist/WEB-INF/lib" file="lib/commons-codec-1.4.jar"/>
    <jar jarfile="ernie.war" basedir="dist"/>
  </target>

</project>

